# ---------------------------------------------------------------------------
#
# Create Foam-Extend-based AMR/LB image
#
# Build
#   apptainer build 
#             --warn-unused-build-args
#             amrlb.sif amrlb.def
#
# Note
#   apptainer version 1.3.1
#
# ---------------------------------------------------------------------------
Bootstrap: localimage
From: fe-{{ FE_VERSION }}-{{ FE_BRANCH }}-ubuntu-{{ UBUNTU_VERSION }}-ompi-{{ OMPI_VERSION }}.sif

%arguments
    UBUNTU_VERSION=24.04
    FE_VERSION=5.0
    FE_BRANCH=master
    OMPI_VERSION=4.1.5

%files
    projects/OMPIFoam /opt/OMPIFoam

%post
    echo "Testing OpenMPI implementation"
    /bin/bash -c "cd /opt/OMPIFoam && mpicc -o ompiTest testOMPI.cpp"
    /bin/bash -c "source /opt/foam/foam-extend-{{ FE_VERSION }}/etc/bashrc && cd /opt/OMPIFoam && wmake"
